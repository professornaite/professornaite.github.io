# Quantitative history

![*Historie Quantitative* by Pierre Chaunu](img/quanthist.jpg){width=50%}


# Mathematical sociology

![*Journal of Mathematical Sociology*](img/math-soc.jpg){width=50%}


# Curriculum and software development

Design, development, implementation, and evaluation of computational curricular materials

---

## Research projects
  
  - ECHO: Education, Community, and Health Observations
  
    - Information and spatial segregation
    
  - Quantifying state violence
  
    - Prisons, a history of the U.S.
    
    - Policing, power and punishment.
    
    - The divided states of america: Politics and the development of an empire
  
  - Statistics and data science education
  
    - Teaching statistical learning and mathematical modeling
    
    - Computation and adult learning
  
  - Maintaining complex theory in quantification
  
    - Theories and conceptions of race and racism
  
---


## Research projects
  
  - ECHO: Education, Community, and Health Observations
  
    - [Information and spatial segregation]{style="color:blue;"}
    
  - [Quantifying state violence]{style="color:blue;"}
  
    - Prisons, a history of the U.S.
    
    - Policing, power and punishment.
    
    - The divided states of america: Politics and the development of an empire
  
  - Statistics and data science education
  
    - Teaching statistical learning and mathematical modeling
    
    - Computation and adult learning
  
  - Maintaining complex theory in quantification
  
    - [Theories and conceptions of race and racism]{style="color:blue;"}

# Project overview: Spatial information and racial isolation

![Washington Post map on Fair Cities Act (1968)](img/us-segregation.jpg){width=50%}

## Information and spatial segregation

[How have histories of racial segregation informed education, community, and health outcomes?]{style="color:blue;"}
  
[Chodrow (2017)](https://www.pnas.org/doi/full/10.1073/pnas.1708201114), examines residential segregation using a taxonomy of smoothing-based segregation metrics, we consider key historical components and markers in the development of a history of "dividing walls".

  - *Historical legacies of injustice*. "The 1968 [Fair Cities] Act expanded on previous acts and prohibited discrimination concerning the sale, rental, and financing of housing based on race, religion, national origin, sex, (and as amended) handicap and family status." ([US Housing and Urban Development](https://www.hud.gov/program_offices/fair_housing_equal_opp/aboutfheo/history), n.d)
  
  - *Traditional modeling approaches*. What has been done more recently and historically?
  
  - *Modern computational tools*. What new (grounded) theoretical insights can be identified?

# A theory and history of dividing walls

# Geometric approach

We adopt a **topological** model for spatial segregation on a geographical area, $G$ to develop a theory of dividing walls.

Builds on the topological and topographical work of Short (2011).

**Theorem 1**. Given any configuration of blue and green towns, there is a dividing wall that separates blue towns from green towns.

![Geographic area with neighborhood units](img/wall-2.png){width=50%}

---

**Theorem 1**. Given any configuration of blue and green towns, there is a dividing wall that separates blue towns from green towns.

![Geographic area with neighborhood units](img/wall-1.png){width=50%}

---

**Theorem 1**. Given any configuration of blue and green towns, there is a dividing wall that separates blue towns from green towns.

![Geographic area with wall dividing neighborhood units](img/wall-0.png){width=50%}

---

## Is there a dividing wall for an island with coastal towns?

![Island with coastal towns](img/wall-3.png){width=50%}

---

## Is there a dividing wall for an island with coastal towns?

![Minimal configuration](img/wall-4.png){width=50%}
---

**Theorem 2**. Alternating configurations of towns do not have a dividing wall, whereas non-alternating configurations of towns do have a dividing wall.

![Alternating configuration (left) and non-alternating configuration (right).](img/wall-5.png){width=50%}

---

### Algebraic approach

We then develop a algebraic modeling approach using methods from **mathematical sociology**.

Segregation indices

  - *Dissimilarity index*: Measures the proportion of one group's population that would need to move to achieve an even distribution across all areas. It ranges from 0 to 1, with higher values indicating greater segregation.

  - *Isolation index*: Measures the extent to which members of a particular group are surrounded by others from the same group. It represents the percentage of people from a specific group who would need to change neighborhoods to achieve an even distribution. Higher values indicate higher isolation and segregation.

---

### Algebraic approach

We then develop a algebraic modeling approach using methods from **mathematical sociology**.

Segregation indices

  - *Exposure index*: Measures the extent to which members of one group are exposed to members of another group. It quantifies the likelihood that a randomly selected individual from one group will encounter individuals from another group. Higher values indicate higher exposure and lower segregation.
  
  - *Concentration index*: Measures the extent to which a particular group is concentrated in specific areas or neighborhoods. It reflects the degree of clustering or dispersion of the group's population across geographic units.

  - *Gini index*: Measure of income inequality, but it can also be adapted to measure residential segregation. It provides a summary measure of the overall distribution of different groups across neighborhoods.
  
---
  
  ## Racial isolation from an algebraic geometry approach
  
  ![Horizontal configuration.](img/horizontal.png){width=50%}

---
  
  ## Racial isolation from an algebraic geometry approach
  
  ![Vertical configuration.](img/vertical.png){width=50%}

## Index of Dissimilarity

$$ D = \dfrac{1}{2} \sum_\limits{i=1}^n  \bigg| \text{Proportion of Black units} - \text{Proportion of non-Black units} \bigg| $$
  
  - $n$ is the number of neighborhoods in a geographic region, 

- $b_i$ is the number of Black household units in neighborhood $i$,

- $B$ is the total number of Black household units in the geographic region,

- $w_i$ is the number of non-Black household units in neighborhood $i$,

- $W$ is the total number of non-Black household units in the geographic region.

---
  
## Index of Dissimilarity
  
  $$ D = \dfrac{1}{2} \sum_\limits{i=1}^n  \bigg| \dfrac{b_i}{B} - \dfrac{w_i}{W} \bigg| $$
    
    - $n$ is the number of neighborhoods in a geographic region, 
  
  - $b_i$ is the number of Black household units in neighborhood $i$,
  
  - $B$ is the total number of Black household units in the geographic region,
  
  - $w_i$ is the number of non-Black household units in neighborhood $i$,
  
  - $W$ is the total number of non-Black household units in the geographic region.
  
---
    
## Computational approach
    
Teaching computational methods and open source tools makes for efficient and accurate learning. In about 5 lines of code, there is an immediate intersection of theory and computation.

Here we use the `tidycensus()` package to gather various metrics.

## Prisons

The U.S. Bureau of Justice Statistics maintains records of federal and state prison populations[^carson].

```{r}
#| echo: false
#| output: false
#| warning: false
library(ggplot2)
library(readr)
library(dplyr)
race <- c("Black", "American Indian", "Latinx", "White", "Asian")
rate <- c(901, 763, 434, 181, 72)
prison_rates_ethnicity <- data.frame(race, rate)
```

```{r}
#| echo: false
#| output: true
#| warning: false

ggplot(prison_rates_ethnicity, aes(race, rate)) +
  geom_col(fill="darkred") +
  geom_text(aes(label=rate), vjust=1.6, color="white", size=3.5) +
  theme_minimal() +
  labs(title= "Imprisonment Rates by Race, 2021",
       subtitle = "Per 100,000 of US residents of each demographic group",
       x ="Race",
       y = "",
       caption = "Carson (2022). Prisoners in 2021.") + 
  theme(panel.background = element_blank())

```
[^carson]: Source: [Carson (2022). Prisoners in 2021 – Statistical tables. Bureau of Justice Statistics.](https://bjs.ojp.gov/library/publications/prisoners-2021-statistical-tables)

## Prisons

To support our framing of contemporary data, we take on an historical view.

```{r}
#| echo: false
#| output: false
#| warning: false
# read in data and update
df <- read_csv("https://raw.githubusercontent.com/professornaite/prisons/main/data/fed_state_prison_pop_1926_1986_clean.csv")


df %>% 
  rename(Count = `Total`,
         TotalPct = `Total Percentage`,
         Type = `Prison Type`,
         WhitePct = `White Percentage`,
         BlackPct = `Black Percentage`) %>% 
  relocate(Year, Type) -> df

# subset data
df_state = df %>% filter(Type == "State")
df_state <- df_state %>% 
  mutate(date = as.Date(Year, format = "%Y-%m-%d"))

df_federal = df %>% filter(Type == "Federal")
df_federal <- df_federal %>% 
  mutate(date = as.Date(Year, format = "%Y-%m-%d"))

df_both = df %>% filter(Type == "State + Federal")
df_both <- df_both %>% 
  mutate(date = as.Date(Year, format = "%Y-%m-%d"))

```

::: {.panel-tabset}

### Federal

Federal racialization data

```{r}
#| echo: false
#| output: false
#| warning: false
f1 <- ggplot(df_state, aes(x=date, y=WhitePct)) +
  geom_line(color="lightblue", size=2) +
  ggtitle("US Federal Prison Racialization (1926 - 1986)") +
  ylab("% Racialized as White") +
  xlab("Year") + 
  ylim(1,100) +
  geom_line()

f2 <- ggplot(df_state, aes(x=date, y=BlackPct)) +
  geom_line(color="red",size=2) +
  ggtitle("US Federal Prison Racialization (1926 - 1986)") +
  ylab("% Racialized as Black") +
  xlab("Year") + 
  ylim(1,100) +
  geom_line()
```

```{r}
#| echo: false
#| output: true
#| warning: false
f1 + f2
```


### State

State racialization data

```{r}
#| echo: false
#| output: false
#| warning: false

s1 <- ggplot(df_federal, aes(x=date, y=WhitePct)) +
  geom_line(color="lightblue", size=2) +
  ggtitle("US State Prison Racialization (1926 - 1986)") +
  ylab("% Racialized as White") +
  xlab("Year") + 
  ylim(1,100) +
  geom_line()

s2 <- ggplot(df_federal, aes(x=date, y=BlackPct)) +
  geom_line(color="red",size=2) +
  ggtitle("US State Prison Racialization (1926 - 1986)") +
  ylab("% Racialized as Black") +
  xlab("Year") + 
  ylim(1,100) +
  geom_line()

```

```{r}
#| echo: false
#| output: true
#| warning: false
s1 + s2
```

### Federal and State

Federal and State racialization data

```{r}
#| echo: false
#| output: false
#| warning: false

b1 <- ggplot(df_both, aes(x=date, y=WhitePct)) +
  geom_line(color="lightblue", size=2) +
  ggtitle("State and Federal Prison Racialization (1926 - 1986)") +
  ylab("% Racialized as White") +
  xlab("Year") + 
  ylim(1,100) +
  geom_line()

b2 <- ggplot(df_both, aes(x=date, y=BlackPct)) +
  geom_line(color="red",size=2) +
  ggtitle("State and Federal Prison Racialization (1926 - 1986)") +
  ylab("% Racialized as Black") +
  xlab("Year") + 
  ylim(1,100) +
  geom_line()
```

```{r}
#| echo: false
#| output: true
#| warning: false
b1 + b2
```

:::


## Racism vs. Anti-Blackness {background-image="https://upload.wikimedia.org/wikipedia/commons/c/c6/Blackboard.png?20200731124623" background-opacity=0.5}

In a 2020 NY Times article, kihana miraya ross chronicles the realities of anti-Blackness. [ross (2020)](https://www.nytimes.com/2020/06/04/opinion/george-floyd-anti-blackness.html) deals with the related but differing functions of racism and anti-Blackness.

::: {.incremental}

  - ross notes that “'racism' fails to fully capture what black people in this country are facing."
  
  - ross continues by noting that "Anti-blackness is one way some black scholars have articulated what it means to be marked as black in an anti-black world."
  
  - Broadly, ross defines anti-Blackness as society's inability to recognize Black people's humanity.

:::


# Broad Implications

  - K-12 teaching and learning
  
    - This also exposes students to a diversity of problems and methods to solve those problems.

  - Computationally-focused research and training in higher education
  
    - Provides an equitable pathway and entry into "high information, high density" conversations.
    
  - Industry and professional organizations

# Gratitude for your time.

# Abstract

We explore how multidimensional measures of local communities -- such as those provided by the Census Community Resilience Estimates (CREs) -- can be used to frame and model dynamic changes in neighborhood communities using an intersectional lens. 

We build on prior research inspired by work on the United States as a "Patchwork Nation."

# Quantitative Histories Workshop

`curriculum & software development collective` 

and

[research lab]{style="color:orange;"}

---

## Project background: Information and spatial segregation

### [Information and theory]{style="color:blue;"}

::: {.incremental}

Information theory is a branch of applied mathematics and computer science that deals with the quantification, storage, transmission, and manipulation of information. 

[We take an abstract approach to our study of information.]{style="color:blue;"}

  - Information theory seeks to measure the amount of information contained in a *message* or signal and how efficiently it can be transmitted or stored.
  
  - This project seeks to define *information* using a critical computational perspective.
  
  - Namely, how might we [leverage computation and quantification]{style="color:blue;"} to transmit information efficiently [while maintaining the roots of complex theories and histories?]{style="color:blue;"}

:::

## {background-image="https://res.cloudinary.com/aenetworks/image/upload/c_fill,w_1920,h_960,g_auto/dpr_auto/f_auto/q_auto:eco/v1/segregation-gettyimages-1084723696?_a=BAVAZGDX0" background-opacity=0.5}

[How have histories of segregation informed education, health, and political outcomes?]{style="color:blue;"}

- Racial segregation

[Photo: Universal History Archive--Universal Images Group]{.absolute bottom=15 left=50}

## {background-image="https://www.brookings.edu/wp-content/uploads/2016/06/homeless007.jpg" background-opacity=0.5}

[How have histories of segregation informed education, health, and political outcomes?]{style="color:blue;"}

- Racial segregation

- Economic segregation

[Photo: Brookings Institution]{.absolute bottom=15 left=50}

## {background-image="https://www.dcpolicycenter.org/wp-content/uploads/2017/04/26378915276_181a4a0b0f_o.jpg" background-opacity=0.5}

[How have histories of segregation informed education, health, and political outcomes?]{style="color:blue;"}

- Racial segregation

- Economic segregation

- Dynamic features of isolation (e.g., measures of segregation)

[Photo: DC Policy Center]{.absolute bottom=15 left=50}

## Mapping Single Dimensions

```{r, include=F, warning=F, results=F, message=F}
dc_income_sf_income <- get_acs(
  geography = "tract",
  variables = "B19013_001",
  state = "DC",
  year = 2023,
  geometry = T
)

dc_income_sf_income
```

```{r, include=F, warning=F, results=F, message=F}
dc_income_sf_blackAAalone <- get_acs(
  geography = "tract",
  variables = "B02001_003",
  state = "DC",
  year = 2023,
  geometry = T
)

dc_income_sf_blackAAalone
```

```{r, include=F, warning=F, results=F, message=F}
dc_income_sf_pov <- get_acs(
  geography = "tract",
  variables = "B17001_002",
  state = "DC",
  year = 2023,
  geometry = T
)

dc_income_sf_pov
```

```{r, include=F, warning=F, results=F, message=F}
dc_income_sf_unemploy <- get_acs(
  geography = "tract",
  variables = "B23025_005",
  state = "DC",
  year = 2023,
  geometry = T
)

dc_income_sf_unemploy
```

::: {.panel-tabset}

## Median Income

```{r, echo=F, warning=F, results=T, message=F}
ggplot(dc_income_sf_income) +
  geom_sf(aes(fill = estimate), color = "white", size = 0.1) +
  scale_fill_viridis(option = "magma", name = "Median Household Income") +
  labs(
    title = "Median Household Income",
    subtitle = "By Census Tract (2023)",
    caption = "Data: American Community Survey 5-Year Estimates"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12),
    axis.title = element_blank(),
    legend.position = "right"
  )
```

## Black Pop.

```{r, echo=F, warning=F, results=T, message=F}
ggplot(dc_income_sf_blackAAalone) +
  geom_sf(aes(fill = estimate), color = "white", size = 0.1) +
  scale_fill_viridis(option = "magma", name = "Black or African American Alone") +
  labs(
    title = "Black or African American Population",
    subtitle = "By Census Tract (2023)",
    caption = "Data: American Community Survey 5-Year Estimates"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12),
    axis.title = element_blank(),
    legend.position = "right"
  )
```

## Pop. Below Poverty Level

```{r, echo=F, warning=F, results=T, message=F}
ggplot(dc_income_sf_pov) +
  geom_sf(aes(fill = estimate), color = "white", size = 0.1) +
  scale_fill_viridis(option = "magma", name = "Population Below Poverty Level") +
  labs(
    title = "Below Poverty Level",
    subtitle = "By Census Tract (2023)",
    caption = "Data: American Community Survey 5-Year Estimates"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12),
    axis.title = element_blank(),
    legend.position = "right"
  )

```

## Unemployed Pop.

```{r, echo=F, warning=F, results=T, message=F}
ggplot(dc_income_sf_unemploy) +
  geom_sf(aes(fill = estimate), color = "white", size = 0.1) +
  scale_fill_viridis(option = "magma", name = "Unemployed Population") +
  labs(
    title = "Population Unemployed",
    subtitle = "By Census Tract (2023)",
    caption = "Data: American Community Survey 5-Year Estimates"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    plot.subtitle = element_text(size = 12),
    axis.title = element_blank(),
    legend.position = "right"
  )
```

:::

## Theoretical framework: A Patchwork Nation

| "*If you pay attention to the complexity of the USA, its diversity and differences you soon realize that the ways we try to understand it – red and blue, Northeast and Midwest – are too simplistic. They are inadequate and misleading*." -Patchwork Nation Project

## Theoretical framework: A Patchwork Nation

::: {.panel-tabset}

## Overview of community types

![[Community types in the Patchwork Nation framing](https://jeffersoninst.org/projects/patchwork-nation){target="_blank"}](img/patchwork-profiles.jpg){width="45%" fig-align="center"}

## Details of relevant community types

- **Boom Towns**: Rapidly expanding communities

- **Campus and Careers**: Areas with a significant presence of higher education institutions

- **Immigration Nation**: Areas with high concentrations of immigrant populations

- **Industrial Metropolis**: Large urban areas with a strong industrial base

- **Emptying Nests**: Communities with an aging population

- **Minority Central**: Areas with large minority populations

- **Monied Burbs**: Affluent suburban areas

:::

---

## Analytic framework: Community Resilience Estimates

- The Census Community Resilience Estimates (CRE) data sets were developed to [assess the social vulnerability and resilience of neighborhoods]{style="color:blue;"} in response to disasters or shocks.

  -- Households with an income-to-poverty ratio less than 130%

  -- Less than one individual living in the household is aged 18–64
  
  -- Household crowding, defined as more than 0.75 persons per room
  
  -- Households with limited education
  
  -- No one in the household is employed full-time year-round
  
  -- Individual with a disability posing a constraint to significant life activity
  
  -- Individual with no health insurance
  
  -- Individual aged 65 or older
  
  -- Households without a vehicle
  
  -- Households without broadband internet access
  
## Analytic framework: Community Resilience Estimates

- CRE estimates are a [measure of the capacity of individuals and households within a community]{style="color:blue;"} to absorb, endure, and recover from external stresses. 

- The CRE data combine American Community Survey (ACS) and the Population Estimates Program (PEP) data to [identify social and economic vulnerabilities by geography]{style="color:blue;"}.

- There is a nice [CRE Interactive Tool](https://mtgis-portal.geo.census.gov/arcgis/apps/experiencebuilder/experience/?id=54292fa3918e425a8717259f930274fb){target="_blank"} that allows for a quick overview of local contexts.

```{r, include=F, warning=F, results=F, message=F}
link <- "https://www2.census.gov/programs-surveys/demo/datasets/community-resilience/2022/CRE_22_Tract.csv"
df_cre <- read.csv(link)

# CRE data for DC
cre.2022.dc <- df_cre %>%
  filter(STATE == "11") # FIPS code for DC

# CRE data for Anacostia, DC
cre.2022.anacostia <- df_cre %>%
  filter(STATE == "11" & COUNTY == "001" & TRACT %in% c("7503", "7504", "7903"))
```

```{r, include=T, warning=F, results=F, message=F}
cre_correlates_dc <- get_acs(
  geography = "tract", state = "DC", year = 2023, survey = "acs5",
  variables = c(
    median_income = "B19013_001",       # Median household income in the past 12 months
    poverty_rate = "B17001_002",        # Number of people below poverty level
    unemployment_rate = "B23025_005",   # Number of civilians (16 years and over) unemployed
    no_health_insurance = "B27010_033", # Number of people with no health insurance coverage
    educ_less_than_hs = "B15003_002",   # Population 25 years and over with less than 9th grade education
    median_age = "B01002_001",          # Median age
    housing_cost_burden = "B25070_010", # Housing units spending 50% or more of income on rent
    no_vehicle = "B08201_002",          # Households with no vehicle available
    black_population = "B02001_003",    # Black or African American alone population
    median_rent = "B25058_001"),        # Median contract rent
  summary_var = "B02001_001",           # Total population (for calculating proportions)
  output = "wide", geometry = FALSE)
```

## Dimensionality in Spatial Models

### [Model development]{style="color:blue;"}

::: {.incremental}

-- Base spatial model formulation: $$ \boldsymbol{y} = \boldsymbol{X}\beta + \tau + \epsilon $$

- $\boldsymbol{y}$ is a $n$ x $1$ response vector

- $\boldsymbol{X}$ is a design matrix that contains explanatory variables

- $\beta$ represents fixed effects coefficients

- $\tau$ denotes spatially dependent random errors

- $\epsilon$ represents independent random errors

:::

## Dimensionality in Spatial Models

### [Model development]{style="color:blue;"}

Response vector structure ($\boldsymbol{y}$): 

$$
\begin{align}
    \boldsymbol{y} &= \begin{bmatrix}
           y_{1} \\
           y_{2} \\
           \vdots \\
           y_{n}
         \end{bmatrix}
  \end{align} 
$$

- Each element, $y_i$, represents the observed response at a neighborhood's location $i$

- These are ordered by adjacency relationships to preserve the geographical context

- Also, review of distributions, spatial autocorrelation (i.e., $Cov(y_i, y_j)$), and decomposition

## Dimensionality in Spatial Models

### [Model development]{style="color:blue;"}

Design matrix of explanatory variables structure ($\boldsymbol{X}$):

$$
\boldsymbol{X} =
\begin{bmatrix}
1 & x_{1, 1} & \ldots & x_{1, p} \\
1 & x_{2, 1} & \ldots & x_{2, p} \\
\vdots & \vdots & \ddots & \vdots \\
1 & x_{n, 1} & \ldots & x_{n, p} \\
\end{bmatrix}
$$

- First column is the intercept term

- Subsequent columns represent $p$ explanatory variables

- Each row corresponds to a specific neighborhood's covariates

## Dimensionality in Spatial Models

### [Sample design matrix of explanatory variables]{style="color:blue;"}

$$
\boldsymbol{X} =
\begin{bmatrix}
1 & 65,000 & 0.62 & 3,200 \\
1 & 28,000 & 0.32 & 5,100 \\
\vdots & \vdots & \vdots & \vdots \\
1 & 127,000 & 0.75 & 6,840 \\
\end{bmatrix}
$$

- Column 1 is the expected value of $\boldsymbol{y}$ when all other predictors are zero

- Variable 1 (column 2) as median income

- Variable 2 (column 3) as the proportion of residents with a high school diploma

- Variable 3 (column 4) as population density (residents/sq. mi)

## Information and spatial segregation

### [Model selection]{style="color:blue;"}

There are multiple models for consideration:

::: {.incremental}

-- `Spatial regression using intersectional interactions`

-- `Structural Equation Modeling (SEM)` with CRE components

--  `Multilevel Analysis of Individual Heterogeneity and Discriminatory Analysis (MAIHDA)`

  - Evans et al. (2024). A Tutorial for Conducting MAIHDA. *Population Health*, Vol. 26, 101664

  - Combines intersectional stratification with neighborhood-level clustering

  - Models individuals nested within: Intersectional strata (e.g., low-income Black men), community typologies from framework (e.g., Patchwork Nation) classifications

:::

## Overview

- [x]  Project background and model development (Nathan, Howard University, faculty)

- [ ]  Case analysis: Health (Bayowa, Howard University, M.S. Data Science)

- [ ]  Dashboard: Race and ethnicity (Jibek, Howard University, Junior, B.S. Computer Science)

- [ ]  Political analysis (Nathan, on behalf of our Morehouse team)

```{r, include=F, warning=F, results=F, message=F}
link <- "https://www2.census.gov/programs-surveys/demo/datasets/community-resilience/2022/CRE_22_Tract.csv"
df_cre <- read.csv(link)
# CRE data for DC
cre.2022.dc <- df_cre %>%
  filter(STATE == "11") # FIPS code for DC
# CRE data for MD
cre.2022.md <- df_cre %>%
  filter(STATE == "24") 
# Calculate proportion of Black population
cre_correlates_dc <- cre_correlates_dc %>%
  mutate(prop_black = black_populationE / summary_est)
# Modify the GEO_ID in cre.2022.dc
cre.2022.dc_modified <- cre.2022.dc %>%
  mutate(GEOID_modified = str_extract(GEO_ID, "\\d+$")) %>%
  mutate(GEOID_modified = str_sub(GEOID_modified, -11)) %>% 
  relocate(GEOID_modified)
# Join data
merged_dc <- cre_correlates_dc %>%
  left_join(cre.2022.dc_modified, by = c("GEOID" = "GEOID_modified"))
# Load the hypertension dataset
link2 <- "https://raw.githubusercontent.com/Bayowar/202-statistics/refs/heads/main/data-table-htn-dx-mortal.csv"
htn_mort_data <- read.csv(link2)
htn_mort_data <- htn_mort_data %>%
  mutate(STATE = ifelse(STATE == "District of Columbia", "DC", STATE))
htn_mort_data

htn_mort_data <- htn_mort_data %>%
  mutate(RATE = as.numeric(RATE))

summary(htn_mort_data$RATE)  #conversion to numeric

htn_mort_data <- htn_mort_data %>%
  mutate(DEATHS = as.numeric(DEATHS))

summary(htn_mort_data$DEATHS)  #conversion to numeric


# State summary
state_summary <- htn_mort_data %>%
  group_by(STATE) %>%
  summarise(
    Mean_Rate = mean(RATE, na.rm = TRUE),
    Median_Rate = median(RATE, na.rm = TRUE),
    Total_Deaths = sum(DEATHS, na.rm = TRUE)
  )
```

# Case analysis: Health

## Hypertension

Hypertension, also known as high blood pressure, is a condition in which the force of blood pushing against the walls of the arteries is consistently too high. 

The condition is a compounding health concern in the United States.

:::{.callout-note appearance="simple"}
Between 2017-2020, an estimated 115.3 million US adults had high blood pressure, representing up to 45% of the adult population.
:::

The prevalence of high blood pressure fluctuations over time:

- Between 1999--2000, high blood pressure was highest at 47.9%
- It reached its lowest points between 2009-2010 and 2013-2014 at 43%
- As of 2017-2020, high blood pressure had a national average of around 48%

---

## Hypertension rate in the US

Time Trend of Hypertension Mortality Rates Over Time in the US

```{r, echo=F, warning=F, message=F}
htn_mort_data%>%
  group_by(YEAR) %>%
  summarise(Mean_Rate = mean(DEATHS, na.rm = TRUE)) %>%
  ggplot(aes(x = YEAR, y = Mean_Rate, group = 1)) +
  geom_line(color = "red") +
  geom_point(color = "blue") +
  labs(title = "Trend of Hypertension Mortality Rates Over Time in the U.S.",
       x = "Year",
       y = "Mean Mortality Rate (per 100,000)") +
  theme_minimal()
```

```{r, echo=F, warning=F, message=F, include=F}
# Define selected states
selected_states <- c( "MD", "DC", "PA", "VA",
                     "WV", "NJ")

htn_mort_2022_selected_states <- htn_mort_data %>%
  filter(STATE %in% selected_states)
tail(htn_mort_2022_selected_states)
```

## Comparative rates in the DMV

Bar chart of Hypertension Morbidity Rates in Proximal States

```{r, echo=F}
ggplot(htn_mort_2022_selected_states, aes(x = STATE, y = RATE)) +
  geom_col(fill = "red", color = "black") +
  labs(title = "Comparison of Hypertension Morbidity Rates for Selected States vs DC",
       x = "State",
       y = "Mortality Rate (per 100,000)") +
  theme_minimal()
```

```{r, echo=F, warning=F, include=F, message=F}
# ACS 2022 5-year estimates for U.S. states
acs_data <- get_acs(
  geography = "tract", 
  state = "DC", # state level data
  variables = c(
    "TOTAL_POPULATION" = "B01003_001",  # Total state population
    "POVERTY_TOTAL" = "B17001_001",  # Total population for poverty rate
    "LABOR_FORCE" = "B23025_003",  # Labor force for unemployment rate
    "UNEMPLOYED" = "B23025_005",  # Unemployed population
    "EDUCATION_TOTAL" = "B15003_001",  # Total population aged 25+ for education rate
    "EDUCATION_BACHELORS" = "B15003_022",  # Population with a bachelor's degree or higher
    "HEALTHCARE_INSURED_TOTAL" = "B27010_001",  # Total population with healthcare insurance
    "HEALTHCARE_UNINSURED_MALE_U19" = "B27010_017",  # Male under 19 without insurance
    "HEALTHCARE_UNINSURED_MALE_19_35" = "B27010_033",  # 19-35 without insurance
    "HEALTHCARE_UNINSURED_35_64" = "B27010_050",  # 35-64 without insurance
    "HEALTHCARE_UNINSURED_ABOVE_64" = "B27010_066",  # Age above 64 without insurance
    black_population = "B02001_003", # Black or African American alone population
    white_population = "B02001_002", 
    american_indian_alaska_native_alone = "B02001_004", 
    asian_alone = "B02001_005",
    native_hawaiian_other_pacific_islander_alone = "B02001_006" 
    ),
  year = 2022,  # Use the 2022 ACS 5-year estimates
  summary_var = "B02001_001",
  survey = "acs5",  # Specify the 5-year survey
  output = "wide"  # Return data in wide format
)

# Calculate proportion of Black and other population
acs_data_ser_dc <- acs_data %>%
  mutate(prop_black = black_populationE / summary_est,
         prop_white = white_populationE / summary_est,
         prop_american_indian_alaska = american_indian_alaska_native_aloneE / summary_est,
         prop_asian_alone = asian_aloneE / summary_est,
         prop_native_hawaiian_other_pacific = native_hawaiian_other_pacific_islander_aloneE / summary_est)

#Create a new column for total uninsured population
acs_data_ser_dc_clean <- acs_data_ser_dc %>%
  mutate(
    HEALTHCARE_UNINSURED_TOTAL = HEALTHCARE_UNINSURED_MALE_U19E +
                                 HEALTHCARE_UNINSURED_MALE_19_35E +
                                 HEALTHCARE_UNINSURED_35_64E+
                                 HEALTHCARE_UNINSURED_ABOVE_64E)

# Rates
acs_data_ser_dc_clean_estimates_ <- acs_data_ser_dc_clean %>%
  mutate(
    POVERTY_RATE = (POVERTY_TOTALE / TOTAL_POPULATIONE) * 100,  # Poverty rate
    UNEMPLOYMENT_RATE = (UNEMPLOYEDE / LABOR_FORCEE) * 100,  # Unemployment rate
    EDUCATION_RATE = (EDUCATION_BACHELORSE / EDUCATION_TOTALE) * 100,  # Education rate
    HEALTHCARE_ACCESS = (HEALTHCARE_INSURED_TOTALE / TOTAL_POPULATIONE) * 100  # Healthcare access rate
  )
head(acs_data_ser_dc_clean_estimates_)

# relevant columns
acs_data_ser_dc_clean_estimates_with_tracts <- acs_data_ser_dc_clean_estimates_ %>%
  select(GEOID, NAME, TOTAL_POPULATIONE,HEALTHCARE_UNINSURED_TOTAL,prop_black,prop_asian_alone,prop_native_hawaiian_other_pacific,prop_american_indian_alaska,prop_white, summary_est, black_populationE, POVERTY_TOTALE,POVERTY_RATE, UNEMPLOYEDE,UNEMPLOYMENT_RATE, EDUCATION_TOTALE,EDUCATION_RATE, HEALTHCARE_ACCESS)

acs_data_ser_dc_clean_estimates_with_tracts_  <- acs_data_ser_dc_clean_estimates_with_tracts %>%
  mutate(STATE = "DC")

link3 <- "https://raw.githubusercontent.com/Bayowar/202-statistics/refs/heads/main/indicator_data_download_20250323-2.csv"
df <- read.csv(link3)

brfss_dc_htn_data <- df %>%
  select("Location", "Indicator.Rate.Value", "Period.of.Measure") %>%
  rename(
    tract = "Location",
    hypertension_rate = "Indicator.Rate.Value",
    year = "Period.of.Measure"
  ) %>%
  mutate(tract = as.character(tract))

brfss_dc_htn_data_dc  <- brfss_dc_htn_data %>%
  mutate(STATE = "DC")

brfss_dc_htn_data_dc  <- brfss_dc_htn_data %>%
  mutate(STATE = "DC")

merged_dc_data <- brfss_dc_htn_data_dc %>%
  left_join(acs_data_ser_dc_clean_estimates_with_tracts_ , by = c("tract" = "GEOID"))

merged_dc_data <- merged_dc_data %>%
  select(-STATE.x) %>%
  rename(STATE = STATE.y)

merged_dc_data_clean <- merged_dc_data %>%
  filter(!is.na(tract))  # Drops rows where NA

summary_by_year <- merged_dc_data_clean %>%
  group_by(year) %>%
  # Explicitly specify dplyr's summarize
  dplyr::summarize(
    mean_hypertension = mean(hypertension_rate, na.rm = TRUE),
    tracts_count = n() 
  )
```

```{r, eval=F, echo=F, warning=F, results=T, message=F}

## The average has remained at 30 percent for DC

### While modeling, we identify minor and negligible differences in the rate.
ggplot(summary_by_year, aes(x = year, y = mean_hypertension)) +
  geom_line(color = "red", linewidth = 1, alpha = 0.6) +  # Original line with transparency
  geom_point(size = 3, color = "blue") +                 # Points to highlight data
  geom_smooth(method = "loess", color = "darkgreen", se = FALSE, linewidth = 1.5) +  # Smoothed line
  labs(
    title = "Hypertension Rates in DC (2013 - 2021)",
    x = "Year",
    y = "Mean Hypertension Rate (%)"
  ) +
  theme_minimal() +
  scale_x_continuous(breaks = seq(2013, 2021, by = 1))  # Show every year on the x-axis
```

## CRE and hypertension morbidity

While the Community Resilience Estimates (CRE) do not directly measure hypertension, there are several indirect connections between hypertension and community resilience:

- **Health Insurance**: One of the CRE risk factors is lack of health insurance. Individuals without health insurance are less likely to receive regular blood pressure screenings and treatment for hypertension.

- **Socioeconomic Factors**: The CRE includes factors like poverty and employment, which are known to influence hypertension rates. 

- **Education**: Limited education is a CRE risk factor. Lower educational attainment is associated with higher rates of hypertension.

- **Age**: The CRE considers households with individuals aged 65 or older as a risk factor. Hypertension increases with age, making older populations more vulnerable to its effects.

```{r, echo=F, warning=F, results=F, message=F}
# Rename race columns (adjust indices based on your data)
merged_dc_data_clean_new <- merged_dc_data_clean %>%
  rename(
    white = prop_white,     
    black = prop_black,
    asian = prop_asian_alone,
    native = prop_american_indian_alaska,
    hawai_pac = prop_native_hawaiian_other_pacific
  )
```

## CRE and hypertension morbidity for DC

```{r, echo=F, warning=F, results=F, message=F}
correlation_vars <- merged_dc_data_clean_new %>%
  select(hypertension_rate, POVERTY_RATE, UNEMPLOYMENT_RATE, EDUCATION_RATE)

cor(correlation_vars, use = "complete.obs")
```

<style>
.reveal table {
  font-size: 0.8em; /* Adjust font size to fit */
  width: 90%;       /* Limit width to avoid overflow */
  margin: auto;     /* Center the table */
}
</style>

```{r}
#| echo: false
#| warning: false
#| message: false

library(knitr)
library(kableExtra)

# Assuming you've already run the correlation
correlation_matrix <- cor(correlation_vars, use = "complete.obs")

# Create a formatted table
cor_table <- kable(correlation_matrix, 
                   caption = "Correlation Matrix of Hypertension and Socioeconomic Factors",
                   digits = 3,
                   format = "html") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = FALSE) %>%
  add_header_above(c(" " = 1, "Variables" = 4)) %>%
  column_spec(1, bold = TRUE)

# Display the table
cor_table
```

## Racial Differences and Hypertension Morbidity for DC

```{r, echo=F, warning=F, results=F, message=F}
# Remove NA values
correlation_vars <- merged_dc_data_clean_new %>%
  # Select only the columns needed for correlation
  select(hypertension_rate, white, black, asian, native, hawai_pac) %>%
  # Remove rows with NA in ANY selected column
  na.omit()

# Calculate correlation matrix
cor_matrix <- cor(correlation_vars, use = "complete.obs")
```

```{r}
#| echo: false
#| warning: false
#| message: false

library(tidyverse)
library(knitr)
library(kableExtra)

# Remove NA values and calculate correlation matrix
correlation_vars <- merged_dc_data_clean_new %>%
  select(hypertension_rate, white, black, asian, native, hawai_pac) %>%
  na.omit()

cor_matrix <- cor(correlation_vars, use = "complete.obs")

# Create a formatted table
cor_table <- kable(cor_matrix, 
                   caption = "Correlation Matrix of Hypertension Rate and Racial Demographics in DC",
                   digits = 3,
                   format = "html") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),
                full_width = FALSE) %>%
  add_header_above(c(" " = 1, "Variables" = 6)) %>%
  column_spec(1, bold = TRUE)
```


```{r, echo=F}
cor_table
```

## Hypertension and CRE

```{r, include=F, echo=F, message=F, warning=F}
# Join data
merged_cre_htn_dc <- merged_dc %>%
  left_join(brfss_dc_htn_data_dc, by = c("GEOID" = "tract"))

# Print the first few rows of the merged dataset
head(merged_cre_htn_dc)
total_rows <- nrow(merged_cre_htn_dc)
print(paste("Total rows:", total_rows))
merged_cre_htn_dc_clean <- merged_cre_htn_dc %>%
  filter(!is.na(hypertension_rate))  # Drops rows where NA
merged_cre_htn_dc_clean_2021 <- merged_cre_htn_dc_clean %>% filter(year == 2021) # Drops rows where NA
merged_cre_htn_dc_clean_2021
```

```{r, echo=F, include=T, message=F, warning=F}
ggplot(merged_cre_htn_dc_clean_2021, aes(x = hypertension_rate, y = PRED3_PE)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", aes(color = "Linear"), se = FALSE) +
  geom_smooth(method = "loess", aes(color = "Non-linear"), se = FALSE) +
  labs(title = "DC: Hypertension Morbidity Rate vs. Community Resilience Estimate",
       x = "Hypertension morbidity rate",
       y = "% Population with 3+ Risk Factors",
       color = "Fit Type") +
  scale_color_manual(values = c("Linear" = "red", "Non-linear" = "blue")) +
  theme_minimal()
```


# Race and Ethnicity

We are also developing a dashboard for internal use to automate some processes.

[US Census Demographics Data Dashboard](https://census-dashboard-3102a5a2e14b.herokuapp.com/){target="_blank"}

## Political analysis

Examining the impact of broader political shifts on neighborhood measures.

- **Project title**:  *Examining Polling Location Changes After The Shelby County Decision: How a Lack of Federal Oversight Impacts Poll Accessibility in Black and Brown Communities*

- **Abstract**: Since the Supreme Court’s Shelby Decision in 2013, states are no longer required to have polling station changes or closures federally reviewed. Given that over 1600 polling locations have been closed or changed since 2013, we ask what factors contribute to these polling location changes and closures? We examine the driving forces behind these changes, and use Census data to determine what implications these polling location changes may have on accessibility in communities of color.

# Special Thanks

**Research assistants**: Myles Ndiritu (Morehouse College), Zoe Williams (Howard University), Kade Davis (Morehouse College), Amari Gray (Morehouse College)

**Lab manager**: Lyrric Jackson (Spelman College)

**Funding**: Alfred P. Sloan Foundation, AUC Data Science Initiative, Data.org

**Partners**: The Carpentries

# References

Chinni, D., & Gimpel, J. (2010). Our Patchwork Nation: The Surprising Truth about the "Real" America. Gotham Books.

Evans, C. R., Leckie, G., Subramanian, S. V., Bell, A., & Merlo, J. (2024). A tutorial for conducting intersectional multilevel analysis of individual heterogeneity and discriminatory accuracy (MAIHDA). SSM - Population Health, 26, Article 101664. https://doi.org/10.1016/j.ssmph.2024.101664.

U.S. Census Bureau. (2024). Community Resilience Estimates. Retrieved March 26, 2025, from https://www.census.gov/programs-surveys/community-resilience-estimates/about.html.